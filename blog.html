<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Zarrin - Blog</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Raleway:wght@700&family=Roboto:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link rel="stylesheet" href="assets/css/style.css" />
  </head>
  <body>
    <header class="navbar">
      <div class="container">
        <a href="index.html" class="logo">
          <img src="assets/img/logo.png" alt="Zarrin Logo Icon" />
          <span>Zarrin</span>
        </a>

        <nav class="nav-links">
          <ul class="nav-menu">
            <li><a href="blog.html" class="active">Blog</a></li>
            <li><a href="#">About</a></li>
          </ul>
          <a href="#" class="search-icon">
            <i class="fas fa-search"></i>
          </a>
          <a href="#" class="btn btn-primary">Contact Us</a>
        </nav>

        <button class="menu-toggle" aria-label="Open menu">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="28"
            height="28"
            fill="currentColor"
            viewBox="0 0 16 16"
          >
            <path
              fill-rule="evenodd"
              d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5"
            />
          </svg>
        </button>
      </div>
    </header>

    <main>
      <section class="blog-page-header container">
        <span class="page-subtitle">OUR BLOGS</span>
        <h2>Find our all blogs from here</h2>
        <p>
          our blogs are written from very research research and well known
          writers writers so that we can provide you the best blogs and articles
          articles for you to read them all along
        </p>
      </section>

      <section class="blog-section container">
        <div class="popular-posts-grid" id="blog-grid">
          <p style="grid-column: 1/-1; text-align: center">Loading posts...</p>
        </div>
      </section>
    </main>

    <footer>
      <section class="cta-section">
        <div class="container">
          <h2>Get our stories delivered From us to your inbox weekly.</h2>

          <form class="cta-form">
            <input type="email" placeholder="Your Email" required />
            <button type="submit" class="btn btn-secondary-white">
              Get started
            </button>
          </form>

          <p class="cta-helper-text">
            Get a response tomorrow if you submit by 9pm today. If we received
            after 9pm will get a reponse the following day.
          </p>
        </div>
      </section>

      <div class="footer-main">
        <div class="container">
          <a href="index.html" class="logo">
            <img src="assets/img/logo.png" alt="Zarrin Logo Icon" />
            <span>Zarrin</span>
          </a>

          <nav class="footer-nav">
            <ul>
              <li><a href="index.html">Home</a></li>
              <li><a href="blog.html">Blog</a></li>
              <li><a href="#">About</a></li>
              <li><a href="#">Contact Us</a></li>
            </ul>
          </nav>

          <div class="social-links">
            <a href="#" aria-label="Facebook">FB</a>
            <a href="#" aria-label="Instagram">IG</a>
            <a href="#" aria-label="LinkedIn">LN</a>
            <a href="#" aria-label="Youtube">YT</a>
          </div>
        </div>
      </div>

      <div class="footer-copyright">
        <div class="container">
          <p>Copyright Ideapeel Inc © 2023. All Right Reserved</p>
        </div>
      </div>
    </footer>

    <script type="module">
      import axios from "https://cdn.jsdelivr.net/npm/axios@1.7.7/+esm";

      // --- API Config ---
      const api = axios.create({
        baseURL: "http://localhost:4000",
        timeout: 5000,
      });
      const $ = (selector) => document.querySelector(selector);

      const fmtDate = (isoString) => {
        if (!isoString) return "";
        return new Date(isoString).toLocaleDateString("en-GB", {
          day: "2-digit",
          month: "long",
          year: "numeric",
        });
      };

      function escapeHtml(str = "") {
        return str.replace(
          /[&<>"']/g,
          (s) =>
            ({
              "&": "&amp;",
              "<": "&lt;",
              ">": "&gt;",
              '"': "&quot;",
              "'": "&#39;",
            }[s])
        );
      }

      // Template Card cho trang Blog (Sử dụng chung style 'post-card')
      function tplCard(post) {
        return `
        <div class="post-card">
          <div class="card-image">
            <img src="${post.coverUrl}" alt="${escapeHtml(post.title)}" />
          </div>
          <div class="post-card-content">
            <div class="post-meta">
              <span class="post-category">${escapeHtml(
                post.category || "General"
              )}</span>
              <span class="post-date">${fmtDate(post.date)}</span>
            </div>
            <h3 class="post-title">${escapeHtml(post.title)}</h3>
            <p class="post-excerpt">${escapeHtml(post.excerpt || "")}</p>
            <a href="post.html?id=${
              post.id
            }" class="post-read-more">Read more...</a>
          </div>
        </div>`;
      }

      // --- Main Function ---
      async function initBlogPage() {
        const grid = $("#blog-grid");
        if (!grid) return;

        try {
          // Lấy tất cả bài viết, sắp xếp mới nhất trước (_sort=date&_order=desc)
          const { data: posts } = await api.get(
            "/posts?_sort=date&_order=desc"
          );

          if (posts.length === 0) {
            grid.innerHTML = `<p style="grid-column:1/-1; text-align:center">No posts found.</p>`;
            return;
          }

          // Render toàn bộ danh sách
          grid.innerHTML = posts.map((p) => tplCard(p)).join("");
        } catch (error) {
          console.error("Failed to load blog posts:", error);
          grid.innerHTML = `<p style="color:red; grid-column:1/-1; text-align:center">Error loading posts. Please try again later.</p>`;
        }
      }

      initBlogPage();
    </script>
  </body>
</html>
